CHIP Number   | < Creator must leave this blank. Editor will assign a number.>
:-------------|:----
Title         | Reward Distributor
Description   | Puzzles that enable continuous on-chain reward distribution to a changing set of recipients.
Author        | [yakuhito](https://github.com/Yakuhito), [Michael Taylor](https://github.com/MichaelTaylor3D)
Editor        | < Creator must leave this blank. Editor will be assigned.>
Comments-URI  | < Creator must leave this blank. Editor will assign a URI.>
Status        | < Creator must leave this blank. Editor will assign a status.>
Category      | Informational
Sub-Category  | Chialisp
Created       | 2025-07-22
Requires      | CHIP-0050 (Action Layer and Slots)
Replaces      | -
Superseded-By | -

## Abstract
The reward distributor is an on-chain application responsible for continuously distributing incentives to a dynamic list of recipients. It is inspired by the [mechanism](https://uploads-ssl.webflow.com/5ad71ffeb79acc67c8bcdaba/5ad8d1193a40977462982470_scalable-reward-distribution-paper.pdf) frequently used on other chains for liquidity farms. The singleton uses a list of active recipients and their weights to distribute rewards each second. Anyone can commit additional funds to be distributed in the current or future epochs. Commitments for the latter can be partially clawed back (i.e., they’re subject to withdrawal penalties) before the start of the epoch designated during deposit. Control over the list of reward recipients depends on which mode the distributor operates in. In the manager mode, an external party can directly add and remove entries from the list. In the NFT mode, the list is built as users stake and unstake NFTs minted by a particular DID, with each NFT having the same weight. **We are making this CHIP to explain the reward distributor’s capabilities with the hope that other projects with similar requirements will be able to use our implementation.**

## Motivation
The reward distributor was first envisioned as a direct result of DIG Network’s need for an on-chain solution that minimizes trust. The DIG reward distribution scheme has three main shareholders:
 * **Reward sponsors** provide the funds used to incentivize stores. They want to see that previous funds have been distributed correctly in the past, and ideally get part of their commitments back if the system doesn’t work as expected.
 * **Managers (validators)** are responsible for checking which stores are eligible for rewards at a given time, as well as maintaining a publicly accessible list of the stores currently being rewarded. They earn a small portion of the total funds in exchange for allowing the system to distribute the rest correctly.
 * **Mirror operators** expect rewards for meeting the eligibility criteria (hosting data and serving it) and a way to ensure those rewards are adequately paid.

The system described above has a centralized component. Namely, a manager is a trusted oracle that publishes off-chain data (a list of entries - mirrors - eligible for rewards) and keeps it up-to-date. This CHIP proposes an on-chain solution to minimize the trust required between the three principal shareholders. It also proposes an alternative mode of operation for the reward distributor, where the manager is replaced by code that adds entries to the payout list when users deposit NFTs minted by a DID and removes them when users wish to unstake their NFTs.

## Backwards Compatibility
This proposal does not introduce any breaking changes.

## Rationale
As mentioned in [DIP-0002](https://github.com/DIG-Network/DIPS/blob/main/DIPs/dip-0002.md), the following requirements were identified after a series of public and private discussions:
 * **XCH and CAT payouts**: Each reward distributor pays incentives in either XCH, the native currency of the Chia blockchain, or in a specific Chia Asset Token (CAT).
 * **Continuous rewards/incentives**: An entry’s payout should accurately reflect its presence (and weight) in the reward list in a given epoch. While a transaction is not made every second, reward recipients should have confidence that a deterministic amount of rewards is set aside for them every second. The accrued amount can only be paid out to them, even if the manager starts misbehaving in the future.
 * **Anyone can commit incentives for future epochs**: Anyone should be able to sponsor future epochs by committing funds. Commitments can be clawed back to account for the possibility that a manager might go rogue or offline. This clawback incurs a penalty, making manager misconduct costly to all parties: the manager loses reputation and future rewards, while the sponsor loses a part of their commitment.
 * **Manager controls the list of active entries**: The manager is the only entity that can add or remove entries from the active entries list. Active entries continuously earn a part of the epoch's total payout. The distribution is weighted according to each entry’s share, which is set by the manager. Alternatively, if the reward distributor operates in the NFT mode, anyone can stake any NFT minted by a predefined DID to add an entry to the list. The user is able to get back their NFT at any time by unstaking it, which also removes their entry from the rewards list.
 * **Fee proportional to total payout amount**: The manager provides an essential service and has to cover network fees for transactions that update the reward recipient list. As such, it makes sense to incentivize the manager by reserving a fixed percentage of each epoch’s total rewards. More generally, reward distributors can be set up to send a fee proportional to distributed incentives to a payout puzzle hash specified at launch.
 * **Payouts can be manually triggered**: Reward recipients are automatically paid out when they are removed from the active entries list. Payouts can also be manually triggered after the accrued rewards exceed a predefined threshold (minimum amount).

## Specification
The reward distributor is a singleton that uses the action layer and slots, as presented in CHIP-0050. It contains the following actions:
 * **sync**: Distributes rewards for the elapsed time since the last sync operation, which occurred in the same epoch.
 * **new_epoch**: Transitions to a new epoch at the end of the current one, also transferring the (manager’s) fee.
 * **commit_incentives** & **withdraw_incentives** : Used to commit incentives for a future epoch (i.e., sponsor it) and to withdraw a previous commitment. The latter operation carries an associated penalty.
 * **add_rewards**: Adds incentives to the current epoch. The amount cannot be clawed back.
 * **add_entry** & **remove_entry**: Used by the manager to modify the active entry list if the distributor is in the ‘manager’ mode
 * **stake** & **unstake**: Used by users to lock and unlock NFTs minted by a DID to add or remove an entry in the active rewards list if the distributor is in the ‘NFT’ mode
 * **inititate_payout**: Initiates a payout of accrued rewards. The payout amount needs to exceed a minimum threshold defined at distributor launch.

The reward distributor’s type is static and set at launch. An NFT reward distributor will not contain the add_entry/remove_entry actions, while a managed reward distributor will not contain the stake/unstake actions. More detailed documentation for the DIG reward distributor can be found [here](https://docs.xchandles.com/techincal-manual/dig-reward-distributor).


## Test Cases
A series of tests covering one or more cases for all actions of the reward distributor are available in chia-wallet-sdk.

## Reference Implementation
The puzzles for the reward distributor can be found [here](https://github.com/DIG-Network/reward-distributor-clsp/tree/main/puzzles/actions/reward_distributor). Drivers and tests for both kinds of reward distributors have been integrated into chia-wallet-sdk. A CLI for deploying and interacting with reward distributors through Coinset.org the Sage RPC is available [here](https://github.com/Yakuhito/slot-machine).

## Security
Because the reward distributor controls committed funds until they’re paid out, puzzle risk is a significant concern, especially in the context of an on-chain app with high complexity. Multiple members of the Chia community have reviewed the puzzles included in this CHIP.

## Copyright
Copyright and rights to this CHIP waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).




